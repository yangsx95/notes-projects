<html>
  <head>
    <meta charset="UTF-8">
    <title>2. Day02 - Gaiden</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css\bootstrap.min.css">
    <link rel="stylesheet" href="css\font-awesome.min.css">
    <link rel="stylesheet" href="css\highlight.css">
    <link rel="stylesheet" href="css\style.css">
    <link rel="stylesheet" href="css\my.css">
  </head>
  <body>
    <div class="wrapper">
      <div class="header">
        <i class="fa fa-bars sidebar-toggle"></i>
        <span class="title"><a href="Day01.html">Gaiden</a></span>
      </div>
      <div class="sidebar">
        <ul>
          <li class="numbered visible">
            <a href="Day01.html" data-alt-hash="day01"><span class="number">1.</span>Day01</a>
            <ul>
              <li class="numbered visible">
                <a href="Day01.html#id-7162f5a11c8e3a956d9aa4ee917bff96000fbc98"><span class="number">1.1.</span>任务详细说明</a>
                <ul>
                  <li class="numbered visible"><a href="Day01.html#mvc"><span class="number">1.1.1.</span>创建项目按照MVC的架构模式创建相应的包结构如下图：</a></li>
                  <li class="numbered visible"><a href="Day01.html#pomxml"><span class="number">1.1.2.</span>pom.xml的依赖配置：</a></li>
                  <li class="numbered visible"><a href="Day01.html#hibernatehibernatecfgxml"><span class="number">1.1.3.</span>配置hibernate的主配置文件:hibernate.cfg.xml</a></li>
                  <li class="numbered visible"><a href="Day01.html#hibernate"><span class="number">1.1.4.</span>根据分析创建实体，并做hibernate的映射，根据需求文档的物理设计</a></li>
                  <li class="numbered visible"><a href="Day01.html#hibernatesession"><span class="number">1.1.5.</span>hibernate的session工具类</a></li>
                  <li class="numbered visible"><a href="Day01.html#id-95d0a5f0a237ffc3bd210b185d1403a7d5bd0b0b"><span class="number">1.1.6.</span>通过过滤器设置请求和回应编码以及权限控制</a></li>
                  <li class="numbered visible"><a href="Day01.html#bean"><span class="number">1.1.7.</span>为了解除各层之间的耦合性，提供一个bean工厂，来实现解耦合，</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="numbered visible">
            <a href="Day02.html" data-alt-hash="day02"><span class="number">2.</span>Day02</a>
            <ul>
              <li class="numbered visible">
                <a href="Day02.html#id-af156bad56b1c2a8dd04f104684a49eb3d4746d7"><span class="number">2.1.</span>任务详情说明</a>
                <ul>
                  <li class="numbered visible"><a href="Day02.html#id-d4579bbd2acc523dc6247c6313a2eb938ed40b41"><span class="number">2.1.1.</span>视图层:</a></li>
                  <li class="numbered visible"><a href="Day02.html#id-16a5af49bb761ed22ec9795aa5db3ab2509b2fb5"><span class="number">2.1.2.</span>控制层：</a></li>
                  <li class="numbered visible"><a href="Day02.html#id-bd5a39d61fc4d09c931d2b4d375ed25242ae7146"><span class="number">2.1.3.</span>业务层：</a></li>
                  <li class="numbered visible"><a href="Day02.html#id-63f45e92b7c574a974500c309a10d022ad4c2dfc"><span class="number">2.1.4.</span>数据访问层</a></li>
                  <li class="numbered visible"><a href="Day02.html#id-9847283c8e82f7ef2487ee4d3f3e94020aa37b1f"><span class="number">2.1.5.</span>商品首页的显示</a></li>
                  <li class="numbered visible"><a href="Day02.html#id-07cce4c07eab88c6b2d963af79a17ab00acd87cb"><span class="number">2.1.6.</span>图书的分类查询：</a></li>
                  <li class="numbered visible"><a href="Day02.html#id-1e90f40b7b77f956fa693e906060db7af1e670c8"><span class="number">2.1.7.</span>商品详情页：</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="numbered visible">
            <a href="Day03.html" data-alt-hash="day03"><span class="number">3.</span>Day03</a>
            <ul>
              <li class="numbered visible">
                <a href="Day03.html#id-914140ee94022822a51225fd8f39e9a54d6f79e5"><span class="number">3.1.</span>任务详情说明</a>
                <ul>
                  <li class="numbered visible"><a href="Day03.html#id-2a7ae62eb10734335d176e0235a52d41b1fab0fc"><span class="number">3.1.1.</span>功能设计</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="numbered visible">
            <a href="Day04.html" data-alt-hash="day04"><span class="number">4.</span>Day04</a>
            <ul>
              <li class="numbered visible">
                <a href="Day04.html#id-a1f28bf4e37b3b38d040c0438a82b4adb42e90a9"><span class="number">4.1.</span>任务详情说明</a>
                <ul>
                  <li class="numbered visible">
                    <a href="Day04.html#id-eebd10b9ea0ed96f1e7f9d66f2d9ddaefcabea4e"><span class="number">4.1.1.</span>功能设计</a>
                    <ul>
                      <li class="numbered invisible">
                        <a href="Day04.html#id-e1703107bce8a40037a8f02bf904265ad6136b82"><span class="number">4.1.1.1.</span>后台服务程序处理：</a>
                        <ul>
                          <li class="unnumbered invisible"><a href="Day04.html#id-db1624598f0a892a82cf7a24b3c9dd669a25f64c">购物车页面如下：</a></li>
                          <li class="unnumbered invisible"><a href="Day04.html#id-ce7b674841625c853dd4a98d8722a6d85252eaa0">购物车业务层接口定义：</a></li>
                          <li class="unnumbered invisible"><a href="Day04.html#id-3c7430c3a8cbc9fa43438c6534596d71a20c6c32">参考实现：</a></li>
                          <li class="unnumbered invisible"><a href="Day04.html#id-641946fb95fb38bf7525d2d10ec27e3ee682dddf">控制层：</a></li>
                          <li class="unnumbered invisible"><a href="Day04.html#jsp">JSP页面</a></li>
                          <li class="unnumbered invisible"><a href="Day04.html#id-ed6c5112aa07b28edbeee6bdd8d145ec6455b893">页面视图展示：</a></li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="numbered visible">
            <a href="Day05.html" data-alt-hash="day05"><span class="number">5.</span>Day05</a>
            <ul>
              <li class="numbered visible">
                <a href="Day05.html#id-5053eee6be99caad723b2f22524c1e2addfee6e9"><span class="number">5.1.</span>任务详细说明：</a>
                <ul>
                  <li class="numbered visible"><a href="Day05.html#id-2a4b9f847b652c5d8aed18c9d80398b917dab9c7"><span class="number">5.1.1.</span>功能设计</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="numbered visible">
            <a href="Day06.html" data-alt-hash="day06"><span class="number">6.</span>Day06</a>
            <ul>
              <li class="numbered visible">
                <a href="Day06.html#id-8de5978d4021ae9620176dbd1451f544ff8f798e"><span class="number">6.1.</span>任务单详细说明：</a>
                <ul>
                  <li class="numbered visible"><a href="Day06.html#id-4c4580cc53ffa82ec1a481ce14f72537efb100ee"><span class="number">6.1.1.</span>功能设计</a></li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </div>
      <div class="content">
        <div class="content-handle"></div>
        <div class="content-container">
          <div class="content-nav content-nav-top">
            <a class="prev-page" href="Day01.html">
            <i class="fa fa-angle-left"></i>
            <span class="number">1.</span>
            Day01
            </a>
            <a class="next-page" href="Day03.html">
            <span class="number">3.</span>
            Day03
            <i class="fa fa-angle-right"></i>
            </a>
          </div>
          <div class="page-toc">
            <ul>
              <li class="numbered visible">
                <a href="#day02"><span class="number">2.</span>Day02</a>
                <ul>
                  <li class="numbered visible">
                    <a href="#id-af156bad56b1c2a8dd04f104684a49eb3d4746d7"><span class="number">2.1.</span>任务详情说明</a>
                    <ul>
                      <li class="numbered visible"><a href="#id-d4579bbd2acc523dc6247c6313a2eb938ed40b41"><span class="number">2.1.1.</span>视图层:</a></li>
                      <li class="numbered visible"><a href="#id-16a5af49bb761ed22ec9795aa5db3ab2509b2fb5"><span class="number">2.1.2.</span>控制层：</a></li>
                      <li class="numbered visible"><a href="#id-bd5a39d61fc4d09c931d2b4d375ed25242ae7146"><span class="number">2.1.3.</span>业务层：</a></li>
                      <li class="numbered visible"><a href="#id-63f45e92b7c574a974500c309a10d022ad4c2dfc"><span class="number">2.1.4.</span>数据访问层</a></li>
                      <li class="numbered visible"><a href="#id-9847283c8e82f7ef2487ee4d3f3e94020aa37b1f"><span class="number">2.1.5.</span>商品首页的显示</a></li>
                      <li class="numbered visible"><a href="#id-07cce4c07eab88c6b2d963af79a17ab00acd87cb"><span class="number">2.1.6.</span>图书的分类查询：</a></li>
                      <li class="numbered visible"><a href="#id-1e90f40b7b77f956fa693e906060db7af1e670c8"><span class="number">2.1.7.</span>商品详情页：</a></li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </div>
          <div class="main-content">
            <h1 id="day02"><span class="number">2.</span>Day02</h1>
            <h2 id="id-af156bad56b1c2a8dd04f104684a49eb3d4746d7"><span class="number">2.1.</span>任务详情说明</h2>
            <p>此任务完成网站的展示，及商品的显示（包括分页显示），以及按类型查询和商品页的显示：</br></p>
            <h3 id="id-d4579bbd2acc523dc6247c6313a2eb938ed40b41"><span class="number">2.1.1.</span>视图层:</h3>
            <p><img src="../img/201.png" alt="图书页面"/></br> 其中index.jsp显示商品列表</br> detail.jsp显示商品详情</br> books_list显示特殊商品列表</br> xxx.jsp根据你自己的开发情况而添加的jsp文件</br></p>
            <h3 id="id-16a5af49bb761ed22ec9795aa5db3ab2509b2fb5"><span class="number">2.1.2.</span>控制层：</h3>
            <p><img src="../img/202.png" alt="图书控制"/></br> BookAction图书商品控制器</br></p>
            <p><span style="color:red">注：以上的控制器划分只是做为参考，并不要求同学严格按此要求开发，你完全可以根据自己的需求来开发请求控制器，并且命名可以自由。</span></br></p>
            <h3 id="id-bd5a39d61fc4d09c931d2b4d375ed25242ae7146"><span class="number">2.1.3.</span>业务层：</h3>
            <p><img src="../img/203.png" alt="业务层"/></br></p>
            <h3 id="id-63f45e92b7c574a974500c309a10d022ad4c2dfc"><span class="number">2.1.4.</span>数据访问层</h3>
            <p><img src="../img/204.png" alt="数据访问层"/></br></p>
            <p><span style="color:red">以上的方法只是参考，真正的代码要根据自己的需求来写，不要只顾抄写，不思考！</span></br></p>
            <h3 id="id-9847283c8e82f7ef2487ee4d3f3e94020aa37b1f"><span class="number">2.1.5.</span>商品首页的显示</h3>
            <p>1、首页的显示(/jsp/book/index.jsp):</br> <img src="../img/205.png" alt="首页"/></br></p>
            <p>在首页中，显示了精选图书、新书和推荐图书，所有在首页的功能里要通过客户端发送请求到后台，查询出两本所有的 精选图书、新书和推荐图书（要用ajax分页），在册过程中，我们通过欢迎页面把请求发送到后台，在web.xml文件中配置一个欢迎页面：</br></p>
            <pre><code class="java">&lt;display-name&gt;Book_Store&lt;/display-name&gt;
    &lt;welcome-file-list&gt;
		&lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
	&lt;/welcome-file-list&gt;
</code></pre>
            <p>在根目录下的index.jsp中配置转向请求：</p>
            <pre><code class="java">&lt;%@ page language=&quot;java&quot; import=&quot;java.util.*&quot; pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot;  prefix=&quot;c&quot; %&gt;
&lt;c:set var=&quot;path&quot; value=&quot;${pageContext.request.contextPath }&quot; scope=&quot;application&quot;&gt;&lt;/c:set&gt;

&lt;c:redirect url=&quot;/book/IndexAction&quot;&gt; &lt;/c:redirect&gt;
</code></pre>
            <p>在此处把web应用路径封装到全局作用中，方便以后提取 通过c:redirect标签转向后台的服务程序执行，即控制器.</br></p>
            <p>控制器：<span style="color:red">【以下的代码只是参考，切记，不要硬抄】</span></p>
            <pre><code class="java">// 获取精选图书
PageBean&lt;Book&gt; bestBook = bookService.queryByCondition(1, 4, &quot;精选图书&quot;);
// 获取推荐图书
PageBean&lt;Book&gt; tuijianBook = bookService.queryByCondition(1, 4, &quot;推荐图书&quot;);
// 获取特价图书
PageBean&lt;Book&gt; specialBook = bookService.queryByCondition(1, 4, &quot;特价图书&quot;);
request.setAttribute(&quot;bestBook&quot;, bestBook);
request.setAttribute(&quot;tuijianBook&quot;, tuijianBook);
request.setAttribute(&quot;specialBook&quot;, specialBook);
// 转发
forward(request, response, true, &quot;/WEB-INF/jsp/book/index.jsp&quot;);
</code></pre>
            <p>转发和重定向的方法</p>
            <pre><code class="java">/***************
	 * 转发或重定向请求
	 * 
	 * @param request
	 * @param response
	 * @param b
	 *            为真，则转换请求，为false,则重定向请求
	 * @param target
	 *            目标资源
	 * @throws IOException
	 * @throws ServletException
	 */
private void forward(HttpServletRequest request, HttpServletResponse response, boolean b, String target)
			throws ServletException, IOException {
	if (b) {
			RequestDispatcher rd = getServletContext().getRequestDispatcher(target);
			rd.forward(request, response);
			return;
	} else {
			String contextPath = getServletContext().getContextPath();
			response.sendRedirect(contextPath + target);
			return;
		}
	}
</code></pre>
            <p>业务层实现：<span style="color:red">【以下的代码只是参考，切记，不要硬抄】</span></p>
            <pre><code class="java">public PageBean&lt;Book&gt; queryByCondition(Integer now, int size, String cate) {
    	// 1.调用dao获取数据
		List&lt;Book&gt; books = ibd.selectByCondition(now, size, cate);
		// 2.获取总记录数
		int total = ibd.rowCount(cate);
		// 3.创建PageBean对象
		PageBean&lt;Book&gt; pb = new PageBean&lt;&gt;(total, size);
		// 4.设置当前的页数和数据
		pb.setCurrent(now);
		pb.setDatas(books);
		// 5.返回
		return pb;
	}
</code></pre>
            <p>数据层实现：<span style="color:red">【以下的代码只是参考，切记，不要硬抄】</span></p>
            <pre><code class="java">@Override
    public List&lt;Book&gt; selectByCondition(Integer now, int size, String cate) {
		// 通过模板来执行
		return (List&lt;Book&gt;) template.execute(new HibernateCallback() {

			@Override
			public Object doInHibernate(Session ses) throws HibernateException {
				Criteria c = ses.createCriteria(Book.class, &quot;b&quot;);
				//
				if (cate != null &amp;&amp; cate.trim().length() &gt; 0) {
					c.createAlias(&quot;b.category&quot;, &quot;c&quot;).add(Restrictions.eq(&quot;c.name&quot;, cate));
				}
				// 返回
				return c.addOrder(Order.asc(&quot;b.id&quot;)).setFirstResult((now - 1) * size).setMaxResults(size)
						.setCacheable(true).list();
			}
		});
	}

	@Override
	public Book findById(Long id) {
		return (Book) template.execute(new HibernateCallback() {

			@Override
			public Object doInHibernate(Session ses) throws HibernateException {
				return ses.get(Book.class, id);
			}
		});
	}

	@Override
	public int rowCount(String cate) {
		Long count = (Long) template.execute(new HibernateCallback() {

			@Override
			public Object doInHibernate(Session ses) throws HibernateException {
				Criteria c = ses.createCriteria(Book.class, &quot;b&quot;);
				// 判断
				if (cate != null) {
					c.createAlias(&quot;b.category&quot;, &quot;c&quot;).add(Restrictions.eq(&quot;c.name&quot;, cate));
				}
				// 返回
				return c.setProjection(Projections.rowCount()).setCacheable(true).uniqueResult();
			}
		});
		return count.intValue();
	}
</code></pre>
            <p><span style="color:red">视图层的index.jsp页面案例代码由项目经理在课堂讲解过程中给予</span></br></p>
            <h3 id="id-07cce4c07eab88c6b2d963af79a17ab00acd87cb"><span class="number">2.1.6.</span>图书的分类查询：</br></h3>
            <p>点击导航的精选图书，进行分类查询：</br> 页面显示：</br> <img src="../img/207.png" alt="精选图书"/></p>
            <p>登录的控制器实现：【<span style="color:red">请自行实现</span>】</br> 登录的业务实现：【<span style="color:red">请自行实现</span>】</br> 登录的数据访问实现：【<span style="color:red">请自行实现</span>】</br> JSP实现【<span style="color:red">请自行实现</span>】</br></p>
            <h3 id="id-1e90f40b7b77f956fa693e906060db7af1e670c8"><span class="number">2.1.7.</span>商品详情页：</br></h3>
            <p>在商品首页，以及分类显示的页面，点击图书，查看详情页面</br> 页面显示:</br> <img src="../img/208.png" alt="图书详情"/></p>
            <p>控制器实现：【<span style="color:red">请自行实现</span>】</br> 业务实现：【<span style="color:red">请自行实现</span>】</br> 数据访问的实现：【<span style="color:red">请自行实现</span>】</br> JSP实现【<span style="color:red">请自行实现</span>】</br></p>
          </div>
          <div class="content-nav content-nav-bottom">
            <a class="prev-page" href="Day01.html">
            <i class="fa fa-angle-left"></i>
            <span class="number">1.</span>
            Day01
            </a>
            <a class="next-page" href="Day03.html">
            <span class="number">3.</span>
            Day03
            <i class="fa fa-angle-right"></i>
            </a>
          </div>
          <div class="footer">
            <p class="credit text-muted">Powered by <a href="https://github.com/kobo/gaiden">Gaiden</a></p>
          </div>
        </div>
      </div>
    </div>
    <script src="js\jquery-2.1.1.min.js"></script>
    <script src="js\highlight.js"></script>
    <script src="js\application.js"></script>
    <script src="js\my.js"></script>
  </body>
</html>
