<html>
  <head>
    <meta charset="UTF-8">
    <title>1. Day01 - Gaiden</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css\bootstrap.min.css">
    <link rel="stylesheet" href="css\font-awesome.min.css">
    <link rel="stylesheet" href="css\highlight.css">
    <link rel="stylesheet" href="css\style.css">
    <link rel="stylesheet" href="css\my.css">
  </head>
  <body>
    <div class="wrapper">
      <div class="header">
        <i class="fa fa-bars sidebar-toggle"></i>
        <span class="title"><a href="Day01.html">Gaiden</a></span>
      </div>
      <div class="sidebar">
        <ul>
          <li class="numbered visible">
            <a href="Day01.html" data-alt-hash="day01"><span class="number">1.</span>Day01</a>
            <ul>
              <li class="numbered visible">
                <a href="Day01.html#id-7162f5a11c8e3a956d9aa4ee917bff96000fbc98"><span class="number">1.1.</span>任务详细说明</a>
                <ul>
                  <li class="numbered visible"><a href="Day01.html#mvc"><span class="number">1.1.1.</span>创建项目按照MVC的架构模式创建相应的包结构如下图：</a></li>
                  <li class="numbered visible"><a href="Day01.html#pomxml"><span class="number">1.1.2.</span>pom.xml的依赖配置：</a></li>
                  <li class="numbered visible"><a href="Day01.html#hibernatehibernatecfgxml"><span class="number">1.1.3.</span>配置hibernate的主配置文件:hibernate.cfg.xml</a></li>
                  <li class="numbered visible"><a href="Day01.html#hibernate"><span class="number">1.1.4.</span>根据分析创建实体，并做hibernate的映射，根据需求文档的物理设计</a></li>
                  <li class="numbered visible"><a href="Day01.html#hibernatesession"><span class="number">1.1.5.</span>hibernate的session工具类</a></li>
                  <li class="numbered visible"><a href="Day01.html#id-95d0a5f0a237ffc3bd210b185d1403a7d5bd0b0b"><span class="number">1.1.6.</span>通过过滤器设置请求和回应编码以及权限控制</a></li>
                  <li class="numbered visible"><a href="Day01.html#bean"><span class="number">1.1.7.</span>为了解除各层之间的耦合性，提供一个bean工厂，来实现解耦合，</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="numbered visible">
            <a href="Day02.html" data-alt-hash="day02"><span class="number">2.</span>Day02</a>
            <ul>
              <li class="numbered visible">
                <a href="Day02.html#id-af156bad56b1c2a8dd04f104684a49eb3d4746d7"><span class="number">2.1.</span>任务详情说明</a>
                <ul>
                  <li class="numbered visible"><a href="Day02.html#id-d4579bbd2acc523dc6247c6313a2eb938ed40b41"><span class="number">2.1.1.</span>视图层:</a></li>
                  <li class="numbered visible"><a href="Day02.html#id-16a5af49bb761ed22ec9795aa5db3ab2509b2fb5"><span class="number">2.1.2.</span>控制层：</a></li>
                  <li class="numbered visible"><a href="Day02.html#id-bd5a39d61fc4d09c931d2b4d375ed25242ae7146"><span class="number">2.1.3.</span>业务层：</a></li>
                  <li class="numbered visible"><a href="Day02.html#id-63f45e92b7c574a974500c309a10d022ad4c2dfc"><span class="number">2.1.4.</span>数据访问层</a></li>
                  <li class="numbered visible"><a href="Day02.html#id-9847283c8e82f7ef2487ee4d3f3e94020aa37b1f"><span class="number">2.1.5.</span>商品首页的显示</a></li>
                  <li class="numbered visible"><a href="Day02.html#id-07cce4c07eab88c6b2d963af79a17ab00acd87cb"><span class="number">2.1.6.</span>图书的分类查询：</a></li>
                  <li class="numbered visible"><a href="Day02.html#id-1e90f40b7b77f956fa693e906060db7af1e670c8"><span class="number">2.1.7.</span>商品详情页：</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="numbered visible">
            <a href="Day03.html" data-alt-hash="day03"><span class="number">3.</span>Day03</a>
            <ul>
              <li class="numbered visible">
                <a href="Day03.html#id-914140ee94022822a51225fd8f39e9a54d6f79e5"><span class="number">3.1.</span>任务详情说明</a>
                <ul>
                  <li class="numbered visible"><a href="Day03.html#id-2a7ae62eb10734335d176e0235a52d41b1fab0fc"><span class="number">3.1.1.</span>功能设计</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="numbered visible">
            <a href="Day04.html" data-alt-hash="day04"><span class="number">4.</span>Day04</a>
            <ul>
              <li class="numbered visible">
                <a href="Day04.html#id-a1f28bf4e37b3b38d040c0438a82b4adb42e90a9"><span class="number">4.1.</span>任务详情说明</a>
                <ul>
                  <li class="numbered visible">
                    <a href="Day04.html#id-eebd10b9ea0ed96f1e7f9d66f2d9ddaefcabea4e"><span class="number">4.1.1.</span>功能设计</a>
                    <ul>
                      <li class="numbered invisible">
                        <a href="Day04.html#id-e1703107bce8a40037a8f02bf904265ad6136b82"><span class="number">4.1.1.1.</span>后台服务程序处理：</a>
                        <ul>
                          <li class="unnumbered invisible"><a href="Day04.html#id-db1624598f0a892a82cf7a24b3c9dd669a25f64c">购物车页面如下：</a></li>
                          <li class="unnumbered invisible"><a href="Day04.html#id-ce7b674841625c853dd4a98d8722a6d85252eaa0">购物车业务层接口定义：</a></li>
                          <li class="unnumbered invisible"><a href="Day04.html#id-3c7430c3a8cbc9fa43438c6534596d71a20c6c32">参考实现：</a></li>
                          <li class="unnumbered invisible"><a href="Day04.html#id-641946fb95fb38bf7525d2d10ec27e3ee682dddf">控制层：</a></li>
                          <li class="unnumbered invisible"><a href="Day04.html#jsp">JSP页面</a></li>
                          <li class="unnumbered invisible"><a href="Day04.html#id-ed6c5112aa07b28edbeee6bdd8d145ec6455b893">页面视图展示：</a></li>
                        </ul>
                      </li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="numbered visible">
            <a href="Day05.html" data-alt-hash="day05"><span class="number">5.</span>Day05</a>
            <ul>
              <li class="numbered visible">
                <a href="Day05.html#id-5053eee6be99caad723b2f22524c1e2addfee6e9"><span class="number">5.1.</span>任务详细说明：</a>
                <ul>
                  <li class="numbered visible"><a href="Day05.html#id-2a4b9f847b652c5d8aed18c9d80398b917dab9c7"><span class="number">5.1.1.</span>功能设计</a></li>
                </ul>
              </li>
            </ul>
          </li>
          <li class="numbered visible">
            <a href="Day06.html" data-alt-hash="day06"><span class="number">6.</span>Day06</a>
            <ul>
              <li class="numbered visible">
                <a href="Day06.html#id-8de5978d4021ae9620176dbd1451f544ff8f798e"><span class="number">6.1.</span>任务单详细说明：</a>
                <ul>
                  <li class="numbered visible"><a href="Day06.html#id-4c4580cc53ffa82ec1a481ce14f72537efb100ee"><span class="number">6.1.1.</span>功能设计</a></li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </div>
      <div class="content">
        <div class="content-handle"></div>
        <div class="content-container">
          <div class="content-nav content-nav-top">
            <a class="next-page" href="Day02.html">
            <span class="number">2.</span>
            Day02
            <i class="fa fa-angle-right"></i>
            </a>
          </div>
          <div class="page-toc">
            <ul>
              <li class="numbered visible">
                <a href="#day01"><span class="number">1.</span>Day01</a>
                <ul>
                  <li class="numbered visible">
                    <a href="#id-7162f5a11c8e3a956d9aa4ee917bff96000fbc98"><span class="number">1.1.</span>任务详细说明</a>
                    <ul>
                      <li class="numbered visible"><a href="#mvc"><span class="number">1.1.1.</span>创建项目按照MVC的架构模式创建相应的包结构如下图：</a></li>
                      <li class="numbered visible"><a href="#pomxml"><span class="number">1.1.2.</span>pom.xml的依赖配置：</a></li>
                      <li class="numbered visible"><a href="#hibernatehibernatecfgxml"><span class="number">1.1.3.</span>配置hibernate的主配置文件:hibernate.cfg.xml</a></li>
                      <li class="numbered visible"><a href="#hibernate"><span class="number">1.1.4.</span>根据分析创建实体，并做hibernate的映射，根据需求文档的物理设计</a></li>
                      <li class="numbered visible"><a href="#hibernatesession"><span class="number">1.1.5.</span>hibernate的session工具类</a></li>
                      <li class="numbered visible"><a href="#id-95d0a5f0a237ffc3bd210b185d1403a7d5bd0b0b"><span class="number">1.1.6.</span>通过过滤器设置请求和回应编码以及权限控制</a></li>
                      <li class="numbered visible"><a href="#bean"><span class="number">1.1.7.</span>为了解除各层之间的耦合性，提供一个bean工厂，来实现解耦合，</a></li>
                    </ul>
                  </li>
                </ul>
              </li>
            </ul>
          </div>
          <div class="main-content">
            <h1 id="day01"><span class="number">1.</span>Day01</h1>
            <h2 id="id-7162f5a11c8e3a956d9aa4ee917bff96000fbc98"><span class="number">1.1.</span>任务详细说明</h2>
            <p>通过需求文档以及项目经理的讲解，对整个项目有了详细的理解，开始对其项目进行开发：</br></p>
            <h3 id="mvc"><span class="number">1.1.1.</span>创建项目按照MVC的架构模式创建相应的包结构如下图：</br></h3>
            <p><img src="../img/2.png" alt="项目结构"/></br> com.tz.online:是项目的公共包，com.tz是域名的反写，online是项目名称</br></p>
            <p><strong>其下的子包中是项目的模块划分以及功能包</strong>:</br></p>
            <blockquote>
              <p>book：商品模块（图书模块）</br> cart：购物车模块</br> entity：实体包 </br> order：订单模块</br> user：用户模块</br> filter：过滤器</br> util：工具包</br> test：测试包</br> exception：自定义异常</br> listener：监听器</br></p>
            </blockquote>
            <p><strong>resources：配置文件包,里面有一些配置文件：</strong></br> <img src="../img/png" alt="resources"/><br></p>
            <blockquote>
              <p>bean.properties:此配置文件主要位bean工厂提供类的全限定名，通过名称</br> hibernate.cfg.xml：hibernate的主配置文件</br> ehcache.xml：hibernate二级缓存的配置</br> log4j.properties：日志的配置</br></p>
            </blockquote>
            <p><strong>WebRoot下的文件夹：</strong></br></p>
            <blockquote>
              <p>images：存放项目中的图片</br> js：存放项目中使用的脚本文件</br> jsp：存放项目中的JSP视图</br> style：存放项目中的样式文件</p>
            </blockquote>
            <p><em>注1：整个项目采用JSP +Servlet + Javabean + Hibernate实现，工程创建出来以后设置项目的编码 ：UTF-8</em> <em>注2：因为采用MAVEN进行项目管理和构建，请按maven进行设置相关的编译环境和依赖管理</em></p>
            <h3 id="pomxml"><span class="number">1.1.2.</span>pom.xml的依赖配置：</h3>
            <pre><code class="nohighlight">    &lt;properties&gt;
    	&lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
		&lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;
		&lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;
		&lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;
		&lt;groovyVersion&gt;2.4.7&lt;/groovyVersion&gt;
		&lt;testngVersion&gt;6.9.8&lt;/testngVersion&gt;
	&lt;/properties&gt;

	&lt;dependencies&gt;
		&lt;!--provided --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;javax.servlet&lt;/groupId&gt;
			&lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;
			&lt;version&gt;3.1.0&lt;/version&gt;
			&lt;scope&gt;provided&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;javax.servlet.jsp&lt;/groupId&gt;
			&lt;artifactId&gt;jsp-api&lt;/artifactId&gt;
			&lt;version&gt;2.2&lt;/version&gt;
			&lt;scope&gt;provided&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;!--runtime --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;jstl&lt;/groupId&gt;
			&lt;artifactId&gt;jstl&lt;/artifactId&gt;
			&lt;version&gt;1.2&lt;/version&gt;
			&lt;scope&gt;runtime&lt;/scope&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.hibernate&lt;/groupId&gt;
			&lt;artifactId&gt;hibernate-core&lt;/artifactId&gt;
			&lt;version&gt;4.3.8.Final&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;log4j&lt;/groupId&gt;
			&lt;artifactId&gt;log4j&lt;/artifactId&gt;
			&lt;version&gt;1.2.17&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.slf4j&lt;/groupId&gt;
			&lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;
			&lt;version&gt;1.7.21&lt;/version&gt;
		&lt;/dependency&gt;
		
		&lt;dependency&gt;
			&lt;groupId&gt;com.oracle&lt;/groupId&gt;
			&lt;artifactId&gt;ojdbc6&lt;/artifactId&gt;
			&lt;version&gt;11.2.0.3&lt;/version&gt;
		&lt;/dependency&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;c3p0&lt;/groupId&gt;
			&lt;artifactId&gt;c3p0&lt;/artifactId&gt;
			&lt;version&gt;0.9.1.2&lt;/version&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;net.sf.ehcache&lt;/groupId&gt;
			&lt;artifactId&gt;ehcache-core&lt;/artifactId&gt;
			&lt;version&gt;2.4.3&lt;/version&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;com.alibaba&lt;/groupId&gt;
			&lt;artifactId&gt;fastjson&lt;/artifactId&gt;
			&lt;version&gt;1.2.17&lt;/version&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;org.hibernate&lt;/groupId&gt;
			&lt;artifactId&gt;hibernate-c3p0&lt;/artifactId&gt;
			&lt;version&gt;4.3.8.Final&lt;/version&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;org.hibernate&lt;/groupId&gt;
			&lt;artifactId&gt;hibernate-ehcache&lt;/artifactId&gt;
			&lt;version&gt;4.3.8.Final&lt;/version&gt;
		&lt;/dependency&gt;

		&lt;!--test --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;junit&lt;/groupId&gt;
			&lt;artifactId&gt;junit&lt;/artifactId&gt;
			&lt;version&gt;4.12&lt;/version&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;

	&lt;build&gt;
		&lt;plugins&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.apache.tomcat.maven&lt;/groupId&gt;
				&lt;artifactId&gt;tomcat7-maven-plugin&lt;/artifactId&gt;
				&lt;version&gt;2.2&lt;/version&gt;
				&lt;configuration&gt;
					&lt;port&gt;8888&lt;/port&gt;
				&lt;/configuration&gt;
			&lt;/plugin&gt;
			&lt;plugin&gt;
				&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
				&lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;
				&lt;version&gt;2.10&lt;/version&gt;
			&lt;/plugin&gt;
		&lt;/plugins&gt;
	&lt;/build&gt;
</code></pre>
            <h3 id="hibernatehibernatecfgxml"><span class="number">1.1.3.</span>配置hibernate的主配置文件:hibernate.cfg.xml</h3>
            <p>a、数据库连接以及连接池属性</p>
            <pre><code class="java<!-- Hibernate主配置文件 -->">&lt;session-factory&gt;
    &lt;!-- 设置Hibernate连接目标数据库的基本信息 --&gt;
	&lt;property name=&quot;connection.driver_class&quot;&gt;
		oracle.jdbc.driver.OracleDriver
	&lt;/property&gt;
	&lt;property name=&quot;connection.url&quot;&gt;
		jdbc:oracle:thin:@localhost:1521:XE
	&lt;/property&gt;
	&lt;property name=&quot;connection.username&quot;&gt;bookstore&lt;/property&gt;
	&lt;property name=&quot;connection.password&quot;&gt;bookstore&lt;/property&gt;

	&lt;!-- 配置c3p0连接池 --&gt;
	&lt;!-- 指定c3p0连接池的支持类 --&gt;
	&lt;property name=&quot;hibernate.connection.provider_class&quot;&gt;org.hibernate.c3p0.internal.C3P0ConnectionProvider&lt;/property&gt;

	&lt;!-- 设置c3p0连接池,最大容量,最小容量,最大语句对象数,超时时间,检测间隔时间,增大的步长 --&gt;
	&lt;property name=&quot;c3p0.max_size&quot;&gt;10&lt;/property&gt;
	&lt;property name=&quot;c3p0.min_size&quot;&gt;2&lt;/property&gt;
	&lt;property name=&quot;c3p0.max_statements&quot;&gt;150&lt;/property&gt;
	&lt;property name=&quot;c3p0.timeout&quot;&gt;3000&lt;/property&gt;
	&lt;property name=&quot;c3p0.idle_test_period&quot;&gt;2000&lt;/property&gt;
	&lt;property name=&quot;c3p0.acquire_increment&quot;&gt;2&lt;/property&gt;
</code></pre>
            <p>b、二级缓存</p>
            <pre><code class="java<!-- 开启二级缓存 -->">    &lt;property name=&quot;cache.use_second_level_cache&quot;&gt;true&lt;/property&gt;

	&lt;!-- 指定二级缓存供应商 --&gt;
	&lt;property name=&quot;hibernate.cache.region.factory_class&quot;&gt;
		org.hibernate.cache.ehcache.EhCacheRegionFactory
	&lt;/property&gt;
</code></pre>
            <p>c、hibernate的数据库属性</p>
            <pre><code class="java<!-- 设置数据库方言 -->">    &lt;property name=&quot;dialect&quot;&gt;
		org.hibernate.dialect.Oracle10gDialect
	&lt;/property&gt;
	&lt;!-- 是否执行DDL语句 --&gt;
	&lt;property name=&quot;hbm2ddl.auto&quot;&gt;update&lt;/property&gt;
	&lt;!-- 是否显示SQL语句 --&gt;
	&lt;property name=&quot;show_sql&quot;&gt;true&lt;/property&gt;
	&lt;!-- 是否格式化SQL语句 --&gt;
	&lt;property name=&quot;format_sql&quot;&gt;true&lt;/property&gt;
	
	&lt;property name=&quot;hibernate.current_session_context_class&quot;&gt;thread&lt;/property&gt;
</code></pre>
            <p>d、映射实体</p>
            <pre><code class="java<!-- 导入注解配置的实体类 -->">    &lt;mapping class=&quot;com.tz.online.entity.Book&quot;/&gt;
	&lt;mapping class=&quot;com.tz.online.entity.Category&quot;/&gt;
	&lt;mapping class=&quot;com.tz.online.entity.User&quot;/&gt;
	&lt;mapping class=&quot;com.tz.online.entity.Address&quot;/&gt;
	&lt;mapping class=&quot;com.tz.online.entity.Order&quot;/&gt;
	&lt;mapping class=&quot;com.tz.online.entity.OrderItem&quot;/&gt;
</code></pre>
            <p><em>注：在开启二级缓存时，引入二级缓存的配置文件：ehcache.xml Hibernate的日志文件：log4j.properties</em></p>
            <h3 id="hibernate"><span class="number">1.1.4.</span>根据分析创建实体，并做hibernate的映射，根据需求文档的物理设计</h3>
            <p><img src="../img/1.png" alt="entity"/></br> 注：分页Bean,有人使用Pageing这个名字，也有人使用PageBean名字，这个无所谓的。</p>
            <h3 id="hibernatesession"><span class="number">1.1.5.</span>hibernate的session工具类</h3>
            <p>在工具包中，hibernate的工具类，hibernate的操作模板类, 如下图：</br> <img src="../img/4.png" alt="session"/></br></p>
            <p><em>模板接口：HibernateCallback.java</em></p>
            <pre><code class="java"> public interface HibernateCallback {
    
	Object doInHibernate(Session ses) throws HibernateException;
}
</code></pre>
            <p><em>模板接口的实现：HibernateTemplate.java</em></p>
            <pre><code class="java"> public class HibernateTemplate {
    
	/**
	 * 模板方法
	 * @param callback 
	 * @return
	 */
	public Object execute(HibernateCallback callback) {
		Session ses = null;
		Transaction tx = null;
		Object obj = null;
		try {
			ses = HibernateUtil.getSession();
			tx = ses.beginTransaction();
			//执行回调方法
			obj = callback.doInHibernate(ses);
			tx.commit();
		} catch (HibernateException e) {
			if (tx != null) {
				tx.rollback();
			}
			e.printStackTrace();
		} finally {
			//采用线程绑定的session, 无需手动关闭
			//...
		}
		return obj;
	}
}
</code></pre>
            <p><em>时间工具类：DateUtil.java</em></p>
            <pre><code class="java"><br/>public class DateUtil {

    /**
	 * 根据年、月、日创建日 期对象
	 */
	public static Date createDate(int year, int month, int date) {
		Calendar cal = Calendar.getInstance();
		cal.set(year, month - 1, date);
		return cal.getTime();
	}

	/**
	 * 格式化日 期 
	 */
	public static String format(Date d, String pattern) {
		String sdate = null;
		if (null != d &amp;&amp; null != pattern) {
			sdate = new SimpleDateFormat(pattern).format(d);
		}
		return sdate;
	}

	/**
	 * 解析日 期
	 */
	public static Date parse(String dateStr, String pattern) {
		Date d = null;
		if (null != dateStr &amp;&amp; null != pattern) {
			try {
				d = new SimpleDateFormat(pattern).parse(dateStr);
			} catch (ParseException e) {
				e.printStackTrace();
			}
		}
		return d;
	}
}
</code></pre>
            <p><em>测试生成表：DDLTest.java</em></p>
            <pre><code class="java">public class DDLTest {
    public static void main(String[] args) {
		Configuration cfg = new Configuration().configure();
		
		SchemaExport se = new SchemaExport(cfg);
		
		//第一个true代表显示sql语句到控制台.
		//第二个true代表是否真正执行sql语句.
		se.create(true, true);
	}
}
</code></pre>
            <p>以上操作执行成功，数据库表生成，整个项目的搭建及其hibernate的环境配置成功！</p>
            <h3 id="id-95d0a5f0a237ffc3bd210b185d1403a7d5bd0b0b"><span class="number">1.1.6.</span>通过过滤器设置请求和回应编码以及权限控制</h3>
            <p>a、编码过滤器：EncodeFilter.java</p>
            <pre><code class="java">@WebFilter(filterName = &quot;encoding&quot;, urlPatterns = &quot;/*&quot;)
public class EncodeFilter implements Filter {
    String encoding;
	String contentType;

	@Override
	public void destroy() {
		// TODO Auto-generated method stub
		System.out.println(&quot;销毁过滤器对象&quot;);
	}

	@Override
	public void doFilter(ServletRequest req, ServletResponse resp, FilterChain chain)
			throws IOException, ServletException {
		// TODO Auto-generated method stub
		HttpServletRequest request = (HttpServletRequest) req;
		HttpServletResponse response = (HttpServletResponse) resp;

		request.setCharacterEncoding(&quot;UTF-8&quot;);
		response.setContentType(&quot;text/html;charset=UTF-8&quot;);

		chain.doFilter(request, response);
	}

	@Override
	public void init(FilterConfig config) throws ServletException {
		// TODO Auto-generated method stub
		System.out.println(&quot;创建过滤器对象&quot;);

		encoding = config.getInitParameter(&quot;encoding&quot;);
		contentType = config.getInitParameter(&quot;contentType&quot;);

	}

}
</code></pre>
            <p>b、权限过滤器：PermissionFilter.java</p>
            <pre><code class="java">@WebFilter(filterName=&quot;permissionFilter&quot;,urlPatterns=&quot;/permission/*&quot;)
public class PermissionFilter implements Filter {
    
	@Override
	public void destroy() {
		// TODO Auto-generated method stub
System.out.println(&quot;销毁过滤器对象&quot;);
	}

	@Override
	public void doFilter(ServletRequest req, ServletResponse resp,
			FilterChain chain) throws IOException, ServletException {
		// TODO Auto-generated method stub
		HttpServletRequest request = (HttpServletRequest) req;
		HttpServletResponse response = (HttpServletResponse) resp;
		
		HttpSession hs = request.getSession();
		//在session 中获得用户对象
		User user = (User) hs.getAttribute(&quot;user&quot;);
		//检查用户是否存在，以判断用户是否登录
		if(user != null){
			chain.doFilter(request, response);
		}else {
			//如果用户不存在，转到登录界面
			response.sendRedirect(request.getContextPath()+&quot;/user/tologin?info=3&quot;);
		}
	}

	@Override
	public void init(FilterConfig config) throws ServletException {
		// TODO Auto-generated method stub
		
		
	}

}
</code></pre>
            <h3 id="bean"><span class="number">1.1.7.</span>为了解除各层之间的耦合性，提供一个bean工厂，来实现解耦合，</h3>
            <p><em>注：此功能需要在项目经理的讲解中完成</em> 首先:bean工厂通过一个properties配置文件和一个工具类实现：</p>
            <p><strong>配置文件:bean.propertie</strong></p>
            <pre><code class="java">#dao config
bookDao=com.tz.online.book.dao.impl.BookDaoImpl
categoryDao=com.tz.online.book.dao.impl.CategoryDaoImpl
orderDao=com.tz.online.order.dao.impl.OrderDaoImpl
userDao=com.tz.online.user.dao.impl.UserDaoImpl
addressDao=com.tz.online.user.dao.impl.AddressDaoImpl
</code></pre>
            <pre><code class="java">#service config
userService=com.tz.online.user.service.impl.UserServiceImpl
bookService=com.tz.online.book.service.impl.BookServiceImpl
orderService=com.tz.online.order.service.impl.OrderServiceImpl
cartService=com.tz.online.cart.service.impl.MemoryCart
</code></pre>
            <p><strong>工具类：BeanFactory.java</strong></p>
            <pre><code class="java">public class PageBean&lt;T&gt; implements Serializable {
    /**
	 * 
	 */
	private static final long serialVersionUID = 1588411677226257098L;
	
	private final int MAX_PAGE_SIZE = 50; //最多每页显示50行
	public static final int DEFAULT_PAGE_SIZE = 8;
	//属性
	private int total; //总记录数
	private int pageSize; //每页显示的记录数，默认是8
	private int pageNum; //总页数
	
	private int first = 1; //第1页
	private int last; //最后1页
	private int previous; //上一页
	private int next; //下一页
	private int current = 1; //当前页,默认是1
	
	private List&lt;T&gt; datas; //存放分页的数据
	
	public PageBean(int total) {
		this(total, DEFAULT_PAGE_SIZE); //默认的每页行数是 8
	}
	
	public PageBean(int total, int pageSize) {
		//赋值
		this.total = total;
		if(pageSize &gt; MAX_PAGE_SIZE) {
			this.pageSize = MAX_PAGE_SIZE;
		} else {
			this.pageSize = pageSize;
		}
		//更新受 pageSize影响的属性
		update();
		
		this.current = 1; //默认当前页就是1
		
		this.next = this.pageNum == 1 ? 1 : this.current + 1;
		this.previous = this.current == 1 ? 1 : this.current - 1;
	}

	public int getTotal() {
		return total;
	}

	public int getPageSize() {
		return pageSize;
	}

	//注意，会影响其它的属性值
	public void setPageSize(int pageSize) {
		this.pageSize = pageSize;
		update();
	}

	private void update() { //更新所有依赖 pageSize的其它属性值
		//根据总记录数和每页记录数，计算出 总页数
		this.pageNum = this.total / this.pageSize;
		if(this.total % this.pageSize != 0) {
			this.pageNum ++;
		}
				
		//给另外的属性赋值
		this.last = this.pageNum; //最后一页，就是总页数
		//此时 this.current的值有可能会大于 this.last
		if(this.current &gt; this.last) {
			//当每页的行数增大后，当前的页码超过最后1页时，则当前页变为最后1页
			this.current = this.last; 
		}
	}

	public int getPageNum() {
		return pageNum;
	}

	public int getFirst() {
		return first;
	}

	public int getLast() {
		return last;
	}

	public void setLast(int last) {
		this.last = last;
	}

	public int getPrevious() {
		return previous;
	}

	public void setPrevious(int previous) {
		this.previous = previous;
	}

	public int getNext() {
		return next;
	}

	public void setNext(int next) {
		this.next = next;
	}

	public int getCurrent() {
		return current;
	}

	//这个方法会影响一些属性
	public void setCurrent(int current) {
		this.current = current;
		//修改 previous和next
		this.previous = this.current == 1 ? 1 : this.current - 1;
		this.next = this.pageNum == 1 ? 1 : this.current + 1;
		if(this.next &gt; this.last) {
			this.next = this.last; //如果超过最后1行，则等于最后1行
		}
	}

	public List&lt;T&gt; getDatas() {
		return datas;
	}

	public void setDatas(List&lt;T&gt; datas) {
		this.datas = datas;
	}

	@Override
	public String toString() {
		StringBuilder builder = new StringBuilder();
		builder.append(&quot;PageBean [total=&quot;).append(total).append(&quot;, pageSize=&quot;).append(pageSize).append(&quot;, pageNum=&quot;)
				.append(pageNum).append(&quot;, first=&quot;).append(first).append(&quot;, last=&quot;).append(last).append(&quot;, previous=&quot;)
				.append(previous).append(&quot;, next=&quot;).append(next).append(&quot;, current=&quot;).append(current).append(&quot;]&quot;);
		return builder.toString();
	}
	
	
}
</code></pre>
            <p><em>至此完成整个项目的环境搭建，以及基础的配置，此过程要在项目经理的讲解过程中完成，随时给予指导，尤其是包结构以及相关类的名称的创建</em></p>
          </div>
          <div class="content-nav content-nav-bottom">
            <a class="next-page" href="Day02.html">
            <span class="number">2.</span>
            Day02
            <i class="fa fa-angle-right"></i>
            </a>
          </div>
          <div class="footer">
            <p class="credit text-muted">Powered by <a href="https://github.com/kobo/gaiden">Gaiden</a></p>
          </div>
        </div>
      </div>
    </div>
    <script src="js\jquery-2.1.1.min.js"></script>
    <script src="js\highlight.js"></script>
    <script src="js\application.js"></script>
    <script src="js\my.js"></script>
  </body>
</html>
